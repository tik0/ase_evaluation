# Heatmap

This set of tools help you create a heatmap and a histogram. It consists of three programs/scripts:

* `stitching.py`: a simple python script that stitches the tracking data from the four cameras to one single file
* `ase-heatmap`: a C++ QT program that creates the heatmap
* `histogram.m`: a small octave script to create a histogram

## `stitching.py`

The file requires the marker id as a parameter. Multiple marker ids may be passed using a comma separated list. Optionally the directory containing the tracking data can be given. Otherwise it is assumed to be in the working directory. It's assumed that tracking file are called `CAMERA_{1..4}_tracking_data.txt`. The stitched data is printed on stdout, so it can easily be piped to a file. Examples:
```
./stitching.py 28,32
./stitching.py 25 ./data-dir/ > stitched.txt
```

## `ase-heatmap`

This program requires Qt 5.0 to be installed. A dynamically linked x86_64 binary is provided. It can easy be build using the Qt Creator.

### Usage

The program expects the stitched data from `stitching.py` as an argument. Optional parameters below:

```
Usage: ./ase-heatmap [options] stitched_data

Options:
  --cutoff <max>           Replace values bigger than <max> with <max>. <max>
                           must be positive integer. If <max> is zero cutoff is
                           ignored. This is the default.
  --hist-output <outfile>  Output visits per field to <outfile>. May be used
                           with octave to build a histogram.
  --robot-radius <r>       Radius of the robot in pixel (default: 50).
  --connect-points         Connect consecutive tracking points using
                           Bresenham's algorithm. Otherwise the mask is only
                           applied to single data points.
  --save-image <image>     Saves the the heatmap under <image>. Fileformat is
                           guessed, see http://doc.qt.io/qt-5/qimage.html#save

Arguments:
  stitched_data            File containing stitched tracking data.
```

The application outputs the mininmal, maximal and average number of visits as well as the variance.

```
max visits: 5698
min visits: 0
average: 210.864471
variance: 94443.757812
```

Keep in mind that those values are internal values. They can be used to find an appropriate value for ```--cutoff```.

### Further explanation

`--cutoff` was required because of outliers in the data. For example, our robot got stuck at the edge of the carpet for a long time. Therefore a lot of tracking points were collected at this point forming a huge maximum. This rendered a useless heatmap with a single red dot. The cutoff prevents this by setting all values bigger than `<max>` to `<max>`.

`--connect-points` connects consecutive tracking points with a line using Bresenham's algorithm. Unfortunately, using our tracking data the heatmap formed a maximum at the edges of the tracking. We assumed this is an artifact from the tracking data, therefore this option is off by default.

## `histogram.m`

This is a simple script creating a histogram. Please, adjust the parameters filename, cutoff, and number of bins in the script. The file should be a file generated by `ase-heatmap --hist-output`.
